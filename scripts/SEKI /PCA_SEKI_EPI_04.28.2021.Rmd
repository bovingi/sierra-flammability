---
title: 'PCA, Max code, all data'
author: "Indra Boving"
date: "04/14/2020"
output:
  pdf_document: default
  html_document: default
---


```{r message=FALSE, warning=FALSE, include=FALSE}
library(ggplot2)
#install.packages("gapminder")
library(gapminder)
#install.packages("data.table")
library(data.table)
#install.packages("purrr")
library(purrr) #for visualizing all variables in one big plot
#install.packages("naniar")
library(naniar)
library(dplyr)
library(tidyverse)
library(devtools)
library(psych)
#install_github("vqv/ggbiplot", force = TRUE)
library(ggbiplot)
#install.packages("ggfortify")
library(ggfortify)
library(ggpubr)
library(here)
here=here::here
```

# Organize Data: 
## 1. Missing values --> NA (data is MCAR, so pair-wise deletion of values makes sense;see:https://towardsdatascience.com/all-about-missing-data-handling-b94b8b5d2184, or https://cran.r-project.org/web/packages/naniar/vignettes/getting-started-w-naniar.html)
## 2. Outliers removed from LFM column using oulierKD (outside 1.5 IQR => NA)
## 3. Median inserted into missing values for missing dry weight (median appropriate for skewed data); imputed missing LFM using lm with mpa as predictor. 
## 4. Normalized flam metrics using the burned sample dry weight (.norm added to names)

###Note: This dataset inludes only Epiradiator and Ignited samples

```{r echo=FALSE, warning=FALSE}
epi.flamdata <- read.csv(here("processed-data/epi.ignite.only.seki.csv")) %>%
  mutate(LFM = lfm.NAs.imputed)
str(epi.flamdata)
```

```{r, warning = FALSE}
distributions <- epi.flamdata %>%
  select(spp, mpa, lfm.outliers.out, lfm.NAs.imputed, sample.wt, dw.flam.sample, ttfg, gd, gti, tti, fh, pfg, fd, temp.max, prop.ignite, dry.norm.fh, dry.norm.gd, dry.norm.fd, dry.norm.pfg, dry.norm.gti, dry.norm.ttfg, dry.norm.tti, ttms, temp.change) %>%
  gather(-spp, key = "var", value = "value") %>%
  ggplot() +
  geom_density(aes(x = value, color = spp)) +
  facet_wrap(~ var, scales = "free")
distributions +
  ggtitle("Epiradiator")
```

Taking the log of the flam metrics, to see if that looks better: 


```{r, include=TRUE}
#not transformed:
epi.flamdata.nolog <- (epi.flamdata[c("fh", "ttfg", "tti", "fd", "gd", "gti", "sample.wt", "pfg",
         "temp.max", "prop.ignite" )])
multi.hist(epi.flamdata.nolog[,sapply(epi.flamdata.nolog, is.numeric)])

## log transform normalized flam metrics:
log.epi.flamdata <- log(epi.flamdata[c("fh", "ttfg", "tti", "fd", "gd", "gti", "sample.wt", "pfg",
         "temp.max", "prop.ignite","mpa", "lfm.NAs.imputed")]) #flam metrics, lfm, and sample weight
multi.hist(log.epi.flamdata[,sapply(log.epi.flamdata, is.numeric)])

#Categorical variables: 
cat.epi.flamdata <- (epi.flamdata[c("hydration", "spp", "year.month", "sample")])
cat.epi.flamdata
```

```{r, include = FALSE}
#Not transformed: 
nolog.epi.flamdata.norm <- (epi.flamdata[c("dry.norm.fh", "dry.norm.gd", "dry.norm.fd", "dry.norm.pfg", "dry.norm.gti", "dry.norm.ttfg", "dry.norm.tti")]) #flam metrics, lfm, and sample weight
multi.hist(nolog.epi.flamdata.norm[,sapply(nolog.epi.flamdata.norm, is.numeric)])

## log transform normalized flam metrics:
log.epi.flamdata.norm <- log(epi.flamdata[c("dry.norm.fh", "dry.norm.gd", "dry.norm.fd", "dry.norm.pfg", "dry.norm.gti", "dry.norm.ttfg", "dry.norm.tti", "mpa", "lfm.NAs.imputed")]) #flam metrics, lfm, and sample weight
multi.hist(log.epi.flamdata.norm[,sapply(log.epi.flamdata.norm, is.numeric)])
```

# Run PCA 4 times: 
##     1. With all variables; all log-transformed
##     2. With only flammability metrics; all log-transformed
##     3. With all variables; NOT log-transformed
##     4. With only flammability metrics; NOT log-transformed


```{r warning=FALSE}
colSums(is.na(epi.flamdata))
epi.flamdata3 <- (epi.flamdata[, c("lfm.NAs.imputed", "mpa",
         "fh", "ttfg", "tti", "fd", "gd", "gti", "sample.wt", "pfg",
         "temp.max", "prop.ignite", "dw.flam.sample")])
str(epi.flamdata3)

epi.flamdata3.pca <- prcomp(na.omit(epi.flamdata3), center = TRUE, scale = TRUE)

print(epi.flamdata3.pca)
plot(epi.flamdata3.pca)
#plot(epi.flamdata3.pca, type = "l")
summary(epi.flamdata3.pca)
#biplot(epi.flamdata3.pca)

f <- ggbiplot::ggbiplot(epi.flamdata3.pca, groups = cat.epi.flamdata[,2], ellipse = TRUE, circle = TRUE, varname.size = 4, alpha = .4) +  # by spp
ggtitle("Not transformed, all valuess")
print(f)

f <- ggbiplot::ggbiplot(epi.flamdata3.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, 
                        varname.size = 4, alpha = .4) +  #
ggtitle("Not transformed, all valuess")  # by Hydration
print(f)

#f <- ggbiplot::ggbiplot(epi.flamdata3.pca, groups = cat.epi.flamdata[,5], ellipse = TRUE, circle = TRUE, 
                       # varname.size = 4, alpha = .4)   # by trial (month and year)
#print(f)

```
# Not transformed, only flam characteristics

```{r warning=FALSE}
epi.flamdata4 <- (epi.flamdata[, c("fh", "ttfg", "tti", "fd", "gd", "gti", "pfg",
         "temp.max")])
str(epi.flamdata4)

epi.flamdata4.pca <- prcomp(na.omit(epi.flamdata4), center = TRUE, scale = TRUE)

print(epi.flamdata4.pca)
plot(epi.flamdata4.pca)
#plot(epi.flamdata4.pca, type = "l")
summary(epi.flamdata4.pca)
#biplot(epi.flamdata4.pca)

f <- ggbiplot::ggbiplot(epi.flamdata4.pca, groups = cat.epi.flamdata[,2], ellipse = TRUE, circle = TRUE, varname.size = 4, alpha = .4)   # by spp +  # by spp
ggtitle("Not transformed, flammability metrics only")
print(f)

f <- ggbiplot::ggbiplot(epi.flamdata4.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, 
                        varname.size = 4, alpha = .4) +  # by spp
ggtitle("Not transformed, flammability metrics only")  # by Hydration
print(f)

f <- ggbiplot::ggbiplot(epi.flamdata4.pca, circle = TRUE, 
                        varname.size = 4, alpha = .1) +  # by spp
ggtitle("Not transformed, flammability metrics only")  # by Hydration
print(f)

#f <- ggbiplot::ggbiplot(epi.flamdata4.pca, groups = cat.epi.flamdata[,5], ellipse = TRUE, circle = TRUE, 
                       # varname.size = 4, alpha = .4)   # by trial (month and year)
#print(f)

```
#Create new dataset for MEMs:

```{r warning=FALSE}
### Plot PCA scores yourself (and thus access for plotting against LFM)

x4 <-predict(epi.flamdata4.pca)  ### generate scores for each row in epi.flamdata2
pca.flam.data4 <- as.data.frame(x4) 

#x6 <-predict(epi.flamdata6.pca)  ### generate scores for each row in epi.flamdata2
#pca.flam.data6 <- as.data.frame(x6) 
#pca.flam.data6[which.min(pca.flam.data6$PC1),]

#all.data <- cbind.data.frame(ignite.only.epi, pca.flam.data6) %>%  #ignite.only.all.epi from Data_Wrangling_DATE.Rmd (so run that one first)
 # mutate(PC1.norm = PC1, PC2.norm = PC2, PC3.norm = PC3, PC4.norm = PC4, PC5.norm = PC5, PC6.norm = PC6, PC7.norm = PC7, PC1 = NULL, PC2 = NULL, PC3 = NULL, PC4 = NULL, PC5 = NULL, PC6 = NULL, PC7 = NULL )

all.data.epi <- cbind(epi.flamdata, pca.flam.data4)
#colSums(is.na(all.data))
str(all.data.epi)

#dataset with the above columns, PCA using imputed NAs (medians), and flam metrics with NAs still in there:
mem.data <- all.data.epi %>% select(individual, site, year, year.month, month, lfm.outliers.out, lfm.NAs.imputed, mpa, dw.flam.sample, ww.flam.sample, sample.wt, spp, start.temp,  gww.gdw.saturated, gdw.gww.saturated, fd, fh, gd, gti, pfg, dry.norm.fd, dry.norm.fh, dry.norm.gd, dry.norm.gti, dry.norm.pfg, temp.max, ttfg, tti, temp.change, PC1, PC2, PC3, PC4, ttms, model, LFM, prop.ignite, bins10lfm) %>% 
  write_csv(here("processed-data/mem.data.seki.epi.csv"))

#check out data: 
str(mem.data)
```

<!-- # Not transformed, only ignition characteristics -->

<!-- ```{r warning=FALSE} -->
<!-- epi.flamdata4.noglow <- (epi.flamdata[, c("fh", "tti", "fd", "gd", "temp.max", "LFM")]) -->
<!-- str(epi.flamdata4.noglow) -->

<!-- epi.flamdata4.noglow.pca <- prcomp(na.omit(epi.flamdata4.noglow), center = TRUE, scale = TRUE) -->

<!-- print(epi.flamdata4.noglow.pca) -->
<!-- plot(epi.flamdata4.noglow.pca) -->
<!-- #plot(epi.flamdata4.noglow.pca, type = "l") -->
<!-- summary(epi.flamdata4.noglow.pca) -->
<!-- #biplot(epi.flamdata4.noglow.pca) -->

<!-- eig.val <- get_eigenvalue(epi.flamdata4.noglow.pca) -->
<!-- eig.val -->

<!-- var <- get_pca_var(epi.flamdata4.noglow.pca) -->
<!-- var -->

<!-- corrplot(var$cos2, is.corr=FALSE) -->

<!-- #Note that, A high cos2 indicates a good representation of the variable on the principal component. In this case the variable is positioned close to the circumference of the correlation circle. A low cos2 indicates that the variable is not perfectly represented by the PCs. In this case the variable is close to the center of the circle. -->

<!-- # Total cos2 of variables on Dim.1 and Dim.2 -->
<!-- fviz_cos2(epi.flamdata4.noglow.pca, choice = "var", axes = 1:2) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata4.noglow.pca, -->
<!--                         groups = cat.epi.flamdata[,2], -->
<!--                         #ellipse = TRUE, -->
<!--                         #circle = TRUE, -->
<!--                         varname.size = 3, -->
<!--                         alpha = .5, -->
<!--                         varname.adjust = 3)   # -->
<!-- ggtitle("Flammability between Species") -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata4.noglow.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) +  # by spp -->
<!-- ggtitle("Not transformed, flammability metrics only")  # by Hydration -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata4.noglow.pca, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .1) +  # by spp -->
<!-- ggtitle("Not transformed, flammability metrics only")  # by Hydration -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata4.noglow.pca, -->
<!--                         circle = TRUE, -->
<!--                         varname.size = 3, -->
<!--                         alpha = .1, -->
<!--                         labels.size = 3, -->
<!--                         varname.adjust = 3) +  # by spp -->
<!-- ggtitle("Flammability Metrics") -->
<!-- print(f) -->

<!-- #f <- ggbiplot::ggbiplot(epi.flamdata4.noglow.pca, groups = cat.epi.flamdata[,5], ellipse = TRUE, circle = TRUE, -->
<!--                        # varname.size = 4, alpha = .4)   # by trial (month and year) -->
<!-- #print(f) -->
<!-- ``` -->

<!-- #Only flame-related metrics -->
<!-- ```{r, warning=FALSE, include = FALSE} -->
<!-- epi.flamdata4a <- (epi.flamdata[, c("fh", "tti", "fd", "temp.max")]) -->
<!-- str(epi.flamdata4a) -->

<!-- epi.flamdata4a.pca <- prcomp(na.omit(epi.flamdata4a), center = TRUE, scale = TRUE) -->

<!-- print(epi.flamdata4a.pca) -->
<!-- plot(epi.flamdata4a.pca) -->
<!-- #plot(epi.flamdata4.pca, type = "l") -->
<!-- summary(epi.flamdata4.pca) -->
<!-- #biplot(epi.flamdata4.pca) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata4a.pca, groups = cat.epi.flamdata[,2], ellipse = TRUE, circle = TRUE, varname.size = 4, alpha = .4)   # by spp +  # by spp -->
<!-- ggtitle("Not transformed, flammability metrics only") -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata4a.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) +  # by spp -->
<!-- ggtitle("Not transformed, flammability metrics only")  # by Hydration -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata4a.pca, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .1) +  # by spp -->
<!-- ggtitle("Not transformed, flammability metrics only")  # by Hydration -->
<!-- print(f) -->

<!-- #f <- ggbiplot::ggbiplot(epi.flamdata4.pca, groups = cat.epi.flamdata[,5], ellipse = TRUE, circle = TRUE, -->
<!--                        # varname.size = 4, alpha = .4)   # by trial (month and year) -->
<!-- #print(f) -->

<!-- ``` -->

<!-- #PCA using values normalized by dry weight: -->
<!-- ```{r warning=FALSE, include = FALSE} -->
<!-- #colSums(is.na(epi.flamdata)) -->
<!-- epi.flamdata5 <- (epi.flamdata[, c( "dry.norm.fh", "dry.norm.gd", "dry.norm.fd", "dry.norm.pfg", "dry.norm.gti", "dry.norm.ttfg", "dry.norm.tti")]) -->

<!-- str(epi.flamdata5) -->
<!-- range(epi.flamdata5) -->
<!-- epi.flamdata[which.max(epi.flamdata$dry.norm.pfg),] -->
<!-- epi.flamdata[which.min(epi.flamdata$dry.norm.gti),] -->
<!-- epi.flamdata5[which.min(epi.flamdata5$dry.norm.gti),] -->

<!-- epi.flamdata5.pca <- prcomp(na.omit(epi.flamdata5), center = TRUE, scale = TRUE) -->

<!-- print(epi.flamdata5.pca) -->
<!-- plot(epi.flamdata5.pca) -->
<!-- summary(epi.flamdata5.pca) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata5.pca, ellipse = TRUE, circle = TRUE, varname.size = 4, alpha = .4) +  # by spp -->
<!-- ggtitle("Flam metrics only, normalized by dry weight of sample (not logged)") -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata5.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) +  # -->
<!-- ggtitle("Flam metrics only, normalized by dry weight of sample (not logged)")  # by Hydration -->
<!-- print(f) -->

<!-- ``` -->
<!-- ```{r warning=FALSE, include = FALSE} -->
<!-- #colSums(is.na(epi.flamdata)) -->
<!-- epi.flamdata5a <- (epi.flamdata[, c( "dry.norm.fh", "dry.norm.fd", "dry.norm.tti", "temp.max")]) -->

<!-- str(epi.flamdata5a) -->
<!-- range(epi.flamdata5a) -->
<!-- epi.flamdata[which.max(epi.flamdata$dry.norm.pfg),] -->
<!-- epi.flamdata[which.min(epi.flamdata$dry.norm.gti),] -->
<!-- epi.flamdata5a[which.min(epi.flamdata5a$dry.norm.gti),] -->

<!-- epi.flamdata5a.pca <- prcomp(na.omit(epi.flamdata5a), center = TRUE, scale = TRUE) -->

<!-- print(epi.flamdata5a.pca) -->
<!-- plot(epi.flamdata5a.pca) -->
<!-- summary(epi.flamdata5a.pca) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata5a.pca, ellipse = TRUE, circle = TRUE, varname.size = 4, alpha = .4) +  # by spp -->
<!-- ggtitle("Flam metrics only, normalized by dry weight of sample (not logged)") -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata5a.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) +  # -->
<!-- ggtitle("Flam metrics only, normalized by dry weight of sample (not logged)")  # by Hydration -->
<!-- print(f) -->

<!-- ``` -->
<!-- ```{r warning=FALSE, include = FALSE} -->
<!-- epi.flamdata6 <- (log.epi.flamdata.norm[, c( "dry.norm.fh", "dry.norm.gd", "dry.norm.fd", "dry.norm.pfg", "dry.norm.gti", "dry.norm.ttfg", "dry.norm.tti")]) -->

<!-- str(epi.flamdata6) -->
<!-- range(epi.flamdata6) -->
<!-- epi.flamdata6[which.min(epi.flamdata6$dry.norm.fd),] -->
<!-- epi.flamdata6[which.min(epi.flamdata6$dry.norm.fh),] -->
<!-- epi.flamdata6[which.min(epi.flamdata6$dry.norm.gd),] -->
<!-- epi.flamdata6[which.min(epi.flamdata6$dry.norm.pfg),] -->
<!-- epi.flamdata6[which.min(epi.flamdata6$dry.norm.gti),] -->

<!-- epi.flamdata6.pca <- prcomp(na.omit(epi.flamdata6), center = TRUE, scale = TRUE) -->

<!-- print(epi.flamdata6.pca) -->
<!-- plot(epi.flamdata6.pca) -->
<!-- summary(epi.flamdata6.pca) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata6.pca, ellipse = TRUE, circle = TRUE, varname.size = 4, alpha = .4) +  # by spp -->
<!-- ggtitle("Flam metrics only, normalized by dry weight of sample and logged") -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata6.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) +  # -->
<!-- ggtitle("Flam metrics only, normalized by dry weight of sample and logged")  # by Hydration -->
<!-- print(f) -->

<!-- ``` -->
<!-- ```{r warning=FALSE, include = FALSE} -->
<!-- epi.flamdata7 <- (log.epi.flamdata.norm[, c( "dry.norm.fh", "dry.norm.gd", "dry.norm.fd", "dry.norm.pfg", "dry.norm.gti", "dry.norm.ttfg", "dry.norm.tti", "mpa", "lfm.NAs.imputed")]) -->

<!-- str(epi.flamdata7) -->
<!-- range(epi.flamdata7) -->

<!-- epi.flamdata7.pca <- prcomp(na.omit(epi.flamdata7), center = TRUE, scale = TRUE) -->

<!-- print(epi.flamdata7.pca) -->
<!-- plot(epi.flamdata7.pca) -->
<!-- summary(epi.flamdata7.pca) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata7.pca, ellipse = TRUE, circle = TRUE, varname.size = 4, alpha = .4) +  # by spp -->
<!-- ggtitle("Flam metrics, normalized by dry weight of sample and logged") -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata7.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) +  # -->
<!-- ggtitle("Flam metrics, normalized by dry weight of sample and logged")  # by Hydration -->
<!-- print(f) -->
<!-- ``` -->

<!-- # 1. -->
<!-- ```{r echo=FALSE, message=FALSE, warning=FALSE, include = FALSE} -->
<!-- epi.flamdata.pca <- princomp(na.omit(log.epi.flamdata), scale=TRUE) -->
<!-- print(epi.flamdata.pca) -->
<!-- plot(epi.flamdata.pca) -->
<!-- #plot(epi.flamdata.pca, type = "l") -->
<!-- summary(epi.flamdata.pca) -->
<!-- #biplot(epi.flamdata.pca) -->
<!-- #str(cat.epi.flamdata) -->
<!-- colSums(is.na(log.epi.flamdata)) -->

<!-- ### biplot by species: -->
<!-- f <- ggbiplot::ggbiplot(epi.flamdata.pca, groups = cat.epi.flamdata[,2], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) + # by spp -->
<!--                         ggtitle("Log-transformed, all valuess") -->
<!-- print(f) -->

<!-- ###biplot by hydration (split at 60% lfm) -->
<!-- f <- ggbiplot::ggbiplot(epi.flamdata.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) +   # by Hydration -->
<!--                         ggtitle("Log-transformed, all valuess") -->
<!-- print(f) -->
<!-- ###biplot by month and year -->
<!-- #f <- ggbiplot::ggbiplot(epi.flamdata.pca, groups = cat.epi.flamdata[,5], ellipse = TRUE, circle = TRUE, -->
<!--                         #varname.size = 4, alpha = .4)   # by trial (month and year) -->
<!-- #print(f) -->

<!-- ``` -->
<!-- # 2. Log transformed, only flam metrics -->
<!-- ```{r warning=FALSE, include = FALSE} -->
<!-- ## remove some extraneous cols, like weights and LFM/XPP: -->
<!-- log.epi.flamdata2 <- log.epi.flamdata %>% -->
<!--   select("fh", "ttfg", "tti", "fd", "gd", "gti", "pfg", -->
<!--          "temp.max", "prop.ignite") -->
<!-- str(log.epi.flamdata2) -->

<!-- epi.flamdata2.pca <- prcomp(log.epi.flamdata2, center = TRUE, scale = TRUE) -->

<!-- print(epi.flamdata2.pca) -->
<!-- #plot(epi.flamdata2.pca) -->
<!-- plot(epi.flamdata2.pca, type = "l") -->
<!-- summary(epi.flamdata2.pca) -->
<!-- #biplot(epi.flamdata2.pca) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata2.pca, groups = cat.epi.flamdata[,2], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) +   # by spp -->
<!--   ggtitle("Log-transformed flam metrics only") -->
<!-- print(f) -->

<!-- f <- ggbiplot::ggbiplot(epi.flamdata2.pca, groups = cat.epi.flamdata[,1], ellipse = TRUE, circle = TRUE, -->
<!--                         varname.size = 4, alpha = .4) + # by Hydration -->
<!-- ggtitle("Log-transformed flam metrics only") -->
<!-- print(f) -->

<!-- #f <- ggbiplot::ggbiplot(epi.flamdata2.pca, groups = cat.epi.flamdata[,5], ellipse = TRUE, circle = TRUE, -->
<!--                         #varname.size = 4, alpha = .4)   # by trial (month and year) -->
<!-- #print(f) -->

<!-- ``` -->

<!-- # Plot PCA scores against LFM: -->
<!-- ```{r echo=FALSE, warning=FALSE, include = FALSE} -->
<!-- ### Plot PCA scores yourself (and thus access for plotting against LFM) -->

<!-- x <-predict(epi.flamdata2.pca)  ### generate scores for each row in epi.flamdata2 -->
<!-- pca.flam.data <- as.data.frame(x) -->

<!-- all.data <- cbind(epi.flamdata, pca.flam.data) -->

<!-- plot(x[,1],x[,2])           ### PC1 PC2 biplot! -->

<!-- plot(x[,1],log.epi.flamdata[,1])  ## PC1 vs logged XPP  ? -->
<!-- plot(x[,1],log.epi.flamdata[,2])  ## PC1 vs logged LFM  ? -->

<!-- ##using ggplot: -->

<!-- print(epi.flamdata2.pca) -->
<!-- lfm.pc1 <- all.data %>% -->
<!--   ggplot(aes(x = lfm.outliers.out, y = PC1))+ -->
<!--   geom_jitter() + -->
<!--   geom_smooth(method = "lm", se = TRUE)  + -->
<!--   stat_cor(label.y = -2, label.x = 15) + -->
<!--   stat_regline_equation(label.y = -2.5, label.x = 15)+ -->
<!--   ggtitle("PC1, lfm not transformed") -->
<!-- lfm.pc1 -->

<!-- lfm.pc2 <- all.data %>% -->
<!--   ggplot(aes(x = lfm.outliers.out, y = PC2))+ -->
<!--   geom_jitter()  + -->
<!--   geom_smooth(method = "lm", se = TRUE)  + -->
<!--   stat_cor(label.y = -2, label.x = 15) + -->
<!--   stat_regline_equation(label.y = -2.5, label.x = 15) + -->
<!--   ggtitle("PC2, lfm not transformed") -->
<!-- lfm.pc2 -->

<!-- all.data <- cbind(log.epi.flamdata, pca.flam.data) -->

<!-- lfm.pc1 <- all.data %>% -->
<!--   ggplot(aes(x = lfm.NAs.imputed, y = PC1))+ -->
<!--   geom_jitter() + -->
<!--   geom_smooth(method = "lm", se = TRUE)  + -->
<!--   stat_cor(label.y = -2, label.x = 2.5) + -->
<!--   stat_regline_equation(label.y = -2.5, label.x = 2.5)+ -->
<!--   ggtitle("PC1, log(lfm)") -->
<!-- lfm.pc1 -->

<!-- lfm.pc2 <- all.data %>% -->
<!--   ggplot(aes(x = lfm.NAs.imputed, y = PC2))+ -->
<!--   geom_jitter()  + -->
<!--   geom_smooth(method = "lm", se = TRUE)  + -->
<!--   stat_cor(label.y = -2, label.x = 2.5) + -->
<!--   stat_regline_equation(label.y = -2.5, label.x = 2.5) + -->
<!--   ggtitle("PC2, log(lfm)") -->
<!-- lfm.pc2 -->


<!-- ``` -->

<!-- # Not transformed, including LFM, Xpp, and Weight -->


