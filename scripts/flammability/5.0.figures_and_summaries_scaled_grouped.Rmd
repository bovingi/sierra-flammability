---
title: "Visualizations and Summaries - Figures"
author: "Indra Boving & Joe Celebrezze"
date: "6/21/2022"
output: html_document
---

# Setup
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(purrr) #for visualizing all variables in one big plot
library(naniar) #for dealing with NAs nicely 
library(tidyverse)
library(ggpubr)
library(cowplot)
library(GGally) #for corr plots
require(kimisc) # has the nlist function to create a named list
library(strengejacke)
library(sjPlot) # table functions
library(here)
library(effects) #for plofhng model effects
library(sjstats) #use for r2 functions
library("broom.mixed")
library(MuMIn)
library(modelsummary)
library(nlme)
library(MetBrewer)
#devtools::install_github("an-bui/calecopal")
library(calecopal)
library(remef)
library(kableExtra)

filter = dplyr::filter
mutate = dplyr::mutate
select = dplyr::select
here = here::here

source(here::here("scripts", "scripts_functions", "figure_info_sierra_flammability.R"))
```

#------------------------------------
# 1. Data Wrangling
Reading in dataframe

- For the Sierra analysis, this is combining all species and dropping the august sampling data (not enough samples and it was measured a lil differently). 

```{r}
mem_data_all <- read_csv(here("processed-data", "analysis 2.0", "sierra_flam_data_all.csv")) %>% 
  select(lfm, mpa, fh, fh, fd, gd,tti, prop_ignite, temp_change, ignition, sample_wt, dry_wt, fresh_wt, water_wt, location, site, year_month, spp, individual) %>% 
  mutate(dw_flam_sample = sample_wt * (dry_wt/fresh_wt),
         ww_flam_sample = sample_wt * (water_wt/fresh_wt)) %>% 
  mutate(excess_water = (ww_flam_sample - dw_flam_sample)) %>% 
  group_by(spp) %>% 
  mutate(mpa_scaled = scale(mpa),
         dw_flam_sample_scaled = scale(dw_flam_sample), 
         sample_wt_scaled = scale(sample_wt), 
         ww_flam_sample_scaled = scale(ww_flam_sample),
         lfm_scaled = scale(lfm), 
         excess_water_scaled = scale(excess_water)) %>% 
  mutate(Species = case_when(
    spp == "arpa" ~ "A. patula", 
    spp == "abco" ~ "A. concolor",
    spp == "cade" ~ "C. decurrens",
    spp == "ceco" ~ "C. cordulatus",
    spp == "pije" ~ "P. jeffreyi",
    spp == "quke" ~ "Q. kelloggii"
  )) %>% 
  filter(!year_month %in% c("2021_august")) %>% 
  filter(ignition != 2) %>% # Removing manual ignitions
  drop_na(mpa_scaled, lfm_scaled, sample_wt_scaled)
#%>% 
  #filter(!spp %in% c("ceco"))
```
## Specifying significance
```{r}
mem_data_all <- mem_data_all %>% 
  mutate(tti.sig = case_when(
    spp == "arpa" ~ "No", spp == "abco" ~ "No", spp == "cade" ~ "No", spp == "ceco" ~ "No", 
    spp == "pije" ~ "No", spp == "quke" ~ "No")) %>% 
  mutate(fh.mpa.sig = case_when(
    spp == "arpa" ~ "Yes", spp == "abco" ~ "Yes", spp == "cade" ~ "No", spp == "ceco" ~ "Yes", 
    spp == "pije" ~ "No", spp == "quke" ~ "Yes")) %>% 
  mutate(fh.lfm.sig = case_when(
    spp == "arpa" ~ "Yes", spp == "abco" ~ "Yes", spp == "cade" ~ "No", spp == "ceco" ~ "Yes", 
    spp == "pije" ~ "No", spp == "quke" ~ "No")) %>% 
  mutate(fd.sig = case_when(
    spp == "arpa" ~ "Yes", spp == "abco" ~ "No", spp == "cade" ~ "No", spp == "ceco" ~ "No", 
    spp == "pije" ~ "No", spp == "quke" ~ "No")) %>% 
  mutate(gd.sig = case_when(
    spp == "arpa" ~ "No", spp == "abco" ~ "No", spp == "cade" ~ "No", spp == "ceco" ~ "Yes", 
    spp == "pije" ~ "No", spp == "quke" ~ "Yes")) %>% 
  mutate(prop.ig.mpa.sig = case_when(
    spp == "arpa" ~ "Yes", spp == "abco" ~ "No", spp == "cade" ~ "No", spp == "ceco" ~ "No", 
    spp == "pije" ~ "No", spp == "quke" ~ "No")) %>% 
  mutate(prop.ig.lfm.sig = case_when(
    spp == "arpa" ~ "Yes", spp == "abco" ~ "No", spp == "cade" ~ "No", spp == "ceco" ~ "No", 
    spp == "pije" ~ "No", spp == "quke" ~ "Yes")) %>% 
  mutate(temp.change.sig = case_when(
    spp == "arpa" ~ "No", spp == "abco" ~ "No", spp == "cade" ~ "No", spp == "ceco" ~ "No", 
    spp == "pije" ~ "No", spp == "quke" ~ "No"))
```


# 2. Remef figures of each flam metric

## TTI
```{r}
mem_data_all_r <- mem_data_all%>% drop_na(mpa_scaled, lfm_scaled, sample_wt_scaled, fh, gd)

tti_mod <- lmer(tti ~ spp*mpa_scaled + spp*lfm_scaled +  site + year_month + sample_wt_scaled + (1 | individual), data = mem_data_all_r)

r_tti_mpa <- remef(tti_mod, fix = c("sample_wt_scaled", "lfm_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with MPa
r_tti_lfm <- remef(tti_mod, fix = c("mpa_scaled", "sample_wt_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with LFM

mem_data_all_r$r_tti_mpa <- r_tti_mpa
mem_data_all_r$r_tti_lfm <- r_tti_lfm

tti_plot <- mem_data_all_r %>% 
  ggplot(aes(y = tti, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = tti.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Time to Ignition (sec)") +
  annotate(geom = "text", x = -1.8, y = 320, label = 'a', fontface = 'bold', size = 10)
tti_plot

tti_plot_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_tti_mpa, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = tti.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Time to Ignition") +
  annotate(geom = "text", x = -1.8, y = 327, label = 'a', fontface = 'bold', size = 10)
tti_plot_r

tti_plot_lfm <- mem_data_all_r %>% 
  ggplot(aes(y = tti, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = tti.sig), alpha = .7) + 
  color_many2 +theme(legend.position = "none", 
axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Time to Ignition (sec)") +
  annotate(geom = "text", x = -2.6, y = 320, label = 'a', fontface = 'bold', size = 10)
tti_plot_lfm

tti_plot_lfm_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_tti_lfm, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = tti.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Time to Ignition") +
  annotate(geom = "text", x = -2.6, y = 320, label = 'a', fontface = 'bold', size = 10)
tti_plot_lfm_r

#ggarrange(tti_plot, tti_plot_r, tti_plot_lfm, tti_plot_lfm_r )
```

## FH
```{r}
fh_mod <- lmer(fh ~ spp*mpa_scaled + spp*lfm_scaled +  site + year_month + sample_wt_scaled + (1 | individual), data = mem_data_all_r)

r_fh_mpa <- remef(fh_mod, fix = c("sample_wt_scaled", "lfm_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with MPa
r_fh_lfm <- remef(fh_mod, fix = c("mpa_scaled", "sample_wt_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with LFM

mem_data_all_r$r_fh_mpa <- r_fh_mpa
mem_data_all_r$r_fh_lfm <- r_fh_lfm

fh_plot <- mem_data_all_r %>% 
  ggplot(aes(y = fh, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = fh.mpa.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Flame Height (cm)") +
  annotate(geom = "text", x = -1.8, y = 54, label = 'b', fontface = 'bold', size = 10)
fh_plot

fh_plot_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_fh_mpa, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = fh.mpa.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Flame Height") +
  annotate(geom = "text", x = -1.8, y = 55, label = 'b', fontface = 'bold', size = 10)
fh_plot_r

fh_plot_lfm <- mem_data_all_r %>% 
  ggplot(aes(y = fh, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = fh.lfm.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Flame Height (cm)") +
  annotate(geom = "text", x = -2.6, y = 54, label = 'b', fontface = 'bold', size = 10)
fh_plot_lfm

fh_plot_lfm_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_fh_lfm, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = fh.lfm.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Flame Height") +
  annotate(geom = "text", x = -2.6, y = 57, label = 'b', fontface = 'bold', size = 10)
fh_plot_lfm_r

#ggarrange(fh_plot, fh_plot_r, fh_plot_lfm, fh_plot_lfm_r, nrow = 2, ncol = 2)
```
## GD
```{r}
gd_mod <- lmer(gd ~ spp*mpa_scaled + spp*lfm_scaled +  site + year_month + sample_wt_scaled + (1 | individual), data = mem_data_all_r)

r_gd_mpa <- remef(gd_mod, fix = c("sample_wt_scaled", "lfm_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with MPa
r_gd_lfm <- remef(gd_mod, fix = c("mpa_scaled", "sample_wt_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with LFM

mem_data_all_r$r_gd_mpa <- r_gd_mpa
mem_data_all_r$r_gd_lfm <- r_gd_lfm

gd_plot <- mem_data_all_r %>% 
  ggplot(aes(y = gd, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = gd.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Glow Duration (sec)") +
  annotate(geom = "text", x = -1.8, y = 485, label = 'c', fontface = 'bold', size = 10)
gd_plot

gd_plot_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_gd_mpa, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = gd.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Glow Duration") +
  annotate(geom = "text", x = -1.8, y = 480, label = 'c', fontface = 'bold', size = 10)
gd_plot_r

gd_plot_lfm <- mem_data_all_r %>% 
  ggplot(aes(y = gd, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = gd.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Glow Duration (sec)") +
  annotate(geom = "text", x = -2.6, y = 460, label = 'c', fontface = 'bold', size = 10)
gd_plot_lfm

gd_plot_lfm_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_gd_lfm, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = gd.sig), alpha = .7) +
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Glow Duration") +
  annotate(geom = "text", x = -2.6, y = 450, label = 'c', fontface = 'bold', size = 10)
gd_plot_lfm_r

#ggarrange(gd_plot, gd_plot_r, gd_plot_lfm, gd_plot_lfm_r, nrow = 2, ncol = 2)
```

## FD
```{r}
fd_mod <- lmer(fd ~ spp*mpa_scaled + spp*lfm_scaled +  site + year_month + sample_wt_scaled + (1 | individual), data = mem_data_all_r)

r_fd_mpa <- remef(fd_mod, fix = c("sample_wt_scaled", "lfm_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with MPa
r_fd_lfm <- remef(fd_mod, fix = c("mpa_scaled", "sample_wt_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with LFM

mem_data_all_r$r_fd_mpa <- r_fd_mpa
mem_data_all_r$r_fd_lfm <- r_fd_lfm

fd_plot <- mem_data_all_r %>% 
  ggplot(aes(y = fd, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = fd.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Flame Duration (sec)") +
  annotate(geom = "text", x = -1.8, y = 96, label = 'd', fontface = 'bold', size = 10)
   
fd_plot

fd_plot_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_fd_mpa, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = fd.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Flame Duration") +
  annotate(geom = "text", x = -1.8, y = 87, label = 'd', fontface = 'bold', size = 10)
fd_plot_r

fd_plot_lfm <- mem_data_all_r %>% 
  ggplot(aes(y = fd, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = fd.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Flame Duration (sec)") +
  annotate(geom = "text", x = -2.6, y = 95, label = 'd', fontface = 'bold', size = 10)
fd_plot_lfm

fd_plot_lfm_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_fd_lfm, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = fd.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Flame Duration") +
  annotate(geom = "text", x = -2.6, y = 88, label = 'd', fontface = 'bold', size = 10)
fd_plot_lfm_r

#ggarrange(fd_plot, fd_plot_r, fd_plot_lfm, fd_plot_lfm_r, nrow = 2, ncol = 2)
```

## Temp Change
```{r}
temp_change_mod <- lmer(temp_change ~ spp*mpa_scaled + spp*lfm_scaled +  site + year_month + spp*sample_wt_scaled + (1 | individual), data = mem_data_all) 

performance::check_collinearity(temp_change_mod)
temp_change_mod
AIC(temp_change_mod)
```

```{r}
temp_change_mod <- lmer(temp_change ~ spp*mpa_scaled + spp*lfm_scaled +  site + year_month + sample_wt_scaled + (1 | individual), data = mem_data_all_r) 
#temp_change_mod_noints <- lmer(temp_change ~ spp + mpa_scaled + lfm_scaled +  site + year_month + sample_wt_scaled + (1 | individual), data = mem_data_all) 

r_temp_change_mpa <- remef(temp_change_mod, fix = c("sample_wt_scaled", "lfm_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with MPa
r_temp_change_lfm <- remef(temp_change_mod, fix = c("mpa_scaled", "sample_wt_scaled", "site"), ran = list(individual = c("(Intercept)"))) # Using Remef for plots with LFM

mem_data_all_r$r_temp_change_mpa <- r_temp_change_mpa
mem_data_all_r$r_temp_change_lfm <- r_temp_change_lfm

temp_change_plot <- mem_data_all_r %>% 
  ggplot(aes(y = temp_change, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = temp.change.sig), alpha = .7) + 
  color_many2 + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Temp. Change (C)") +
  annotate(geom = "text", x = -1.8, y = 250, label = 'e', fontface = 'bold', size = 10)
temp_change_plot

temp_change_plot_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_temp_change_mpa, 
             x = mpa_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = temp.change.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title.x = element_text(size = 18, face = 'bold'), axis.title.y = element_text(size = 22, face = 'bold')) +
  labs(x = "Water Potential (Scaled)", 
       y = "Temp. Change") +
  annotate(geom = "text", x = -1.8, y = 255, label = 'e', fontface = 'bold', size = 10)
temp_change_plot_r

temp_change_plot_lfm <- mem_data_all_r %>% 
  ggplot(aes(y = temp_change, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = temp.change.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Temp. Change (C)") +
  annotate(geom = "text", x = -2.6, y = 245, label = 'e', fontface = 'bold', size = 10)
temp_change_plot_lfm

temp_change_plot_lfm_r <- mem_data_all_r %>% 
  ggplot(aes(y = r_temp_change_lfm, 
             x = lfm_scaled, 
             group = spp)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = temp.change.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title.x = element_text(size = 18, face = 'bold'), axis.title.y = element_text(size = 22, face = 'bold'))+
  labs(x = "LFM (Scaled)", 
       y = "Temp. Change") +
  annotate(geom = "text", x = -2.6, y = 255, label = 'e', fontface = 'bold', size = 10)
temp_change_plot_lfm_r

#ggarrange(temp_change_plot, temp_change_plot_r, temp_change_plot_lfm, temp_change_plot_lfm_r, nrow = 2, ncol = 2)
```

## Prop. Ignite
```{r}
prop_ignite_mod <- lmer(prop_ignite ~ spp*mpa_scaled + spp*lfm_scaled + sample_wt_scaled + site + year_month + (1 | individual), data = mem_data_all_r)
#prop_ignite_mod_noints <- lmer(prop_ignite ~ spp + mpa_scaled + lfm_scaled  + site + year_month + (1 | individual), data = mem_data_all)

r_prop_ignite_mpa <- remef(prop_ignite_mod, fix = c("sample_wt_scaled","lfm_scaled","site"), ran = list(individual = c("(Intercept)")))
r_prop_ignite_lfm <- remef(prop_ignite_mod, fix = c("sample_wt_scaled","mpa_scaled","site"), ran = list(individual = c("(Intercept)")))

mem_data_prop_ignite_r <- mem_data_all_r %>% 
  drop_na(prop_ignite)
mem_data_prop_ignite_r$r_prop_ignite_mpa <- r_prop_ignite_mpa
mem_data_prop_ignite_r$r_prop_ignite_lfm <- r_prop_ignite_lfm

prop_ignite_plot <- mem_data_prop_ignite_r %>% 
  ggplot(aes(y = prop_ignite, 
             x = mpa_scaled, 
             group = spp)) +
  scale_y_continuous(limits = c(15, 110), breaks = c(25, 50, 75, 100)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = prop.ig.mpa.sig), alpha = .7) + 
  color_many2 + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold')) +
  labs(x = "", 
       y = "Proportion Ignited (%)") +
  annotate(geom = "text", x = -1.8, y = 107.5, label = 'f', fontface = 'bold', size = 10)
prop_ignite_plot

prop_ignite_plot_r <- mem_data_prop_ignite_r %>% 
  ggplot(aes(y = r_prop_ignite_mpa, 
             x = mpa_scaled, 
             group = spp)) +
  scale_y_continuous(limits = c(15, 110), breaks = c(25, 50, 75, 100)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = prop.ig.mpa.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold'))+
  labs(x = "", 
       y = "Proportion Ignited") +
  annotate(geom = "text", x = -1.8, y = 107.5, label = 'f', fontface = 'bold', size = 10)
prop_ignite_plot_r

prop_ignite_plot_lfm <- mem_data_prop_ignite_r %>% 
  ggplot(aes(y = prop_ignite, 
             x = lfm_scaled, 
             group = spp)) +
  scale_y_continuous(limits = c(15, 110), breaks = c(25, 50, 75, 100)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = prop.ig.lfm.sig), alpha = .7) + 
  color_many2 + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold')) +
  labs(x = "", 
       y = "Proportion Ignited (%)") +
  annotate(geom = "text", x = -2.6, y = 107.5, label = 'f', fontface = 'bold', size = 10)
prop_ignite_plot_lfm

prop_ignite_plot_lfm_r <- mem_data_prop_ignite_r %>% 
  ggplot(aes(y = r_prop_ignite_lfm, 
             x = lfm_scaled, 
             group = spp)) +
  scale_y_continuous(limits = c(15, 110), breaks = c(25, 50, 75, 100)) +
  geom_point(alpha= .45, aes(color = Species))+
  geom_smooth(method = "lm", se = F, aes(color = Species, lty = prop.ig.lfm.sig), alpha = .7) + 
  color_many2  + theme(legend.position = "none",                                   axis.text = element_text(size = 14), axis.title = element_text(size = 22, face = 'bold')) +
  labs(x = "", 
       y = "Proportion Ignited") +
  annotate(geom = "text", x = -2.6, y = 107.5, label = 'f', fontface = 'bold', size = 10)
prop_ignite_plot_lfm_r

#ggarrange(prop_ignite_plot, prop_ignite_plot_r, prop_ignite_plot_lfm, prop_ignite_plot_lfm_r, nrow = 2, ncol = 2)
```

It looks like it doesnt make a huge difference if we use remef or not, so we'll go ahead and use it.
Now, putting all figures together, remef only: 

# All together
```{r}
plot_legend <- mem_data_all_r %>% 
  ggplot(aes(x = tti, y = mpa, group = Species)) +
  geom_point(aes(color = Species), size = 2.2) +
  geom_smooth(se = F, method = 'lm', aes(color = Species, lty = fh.mpa.sig)) +
  color_many2  +
  labs(color = "Species", lty = "Significant?") +
  theme(legend.text = element_text(size = 16, face = 'italic'), 
        legend.title = element_text(size = 22, face = 'bold'),
        legend.key = element_rect(fill = 'white')) +
  guides(lty = guide_legend(override.aes = list(color = 'black')))

legend <- cowplot::get_legend(plot_legend)
```

#### MPa
```{r, fig.height=5, fig.width=9}
#Mpas:
plots <- cowplot::plot_grid(tti_plot_r,
          fh_plot_r,
          gd_plot_r,
          fd_plot_r,
          temp_change_plot_r,
          prop_ignite_plot_r
          #, 
         # ncol = 3, 
         # nrow = 2, 
          )
plots
plots_legend <- cowplot::plot_grid(plots, legend, rel_widths = c(5, 1))
plots_legend

#ggsave(plot=plots_legend, bg = "white" , here::here("figures", "mpa_flam_metrics.jpeg"), device="jpg")

ggsave(plot=plots_legend, bg = "white" , here::here("figures", "mpa_flam_metrics_withceco.jpeg"), device="jpg")
```

#### LFM
```{r, fig.height=5, fig.width=9}
plots <- cowplot::plot_grid(tti_plot_lfm_r,
          fh_plot_lfm_r,
          gd_plot_lfm_r,
          fd_plot_lfm_r,
          temp_change_plot_lfm_r,
          prop_ignite_plot_lfm_r
          #, 
         # ncol = 3, 
         # nrow = 2, 
          )
plots
plots_legend <- cowplot::plot_grid(plots, legend, rel_widths = c(5, 1))
plots_legend

#ggsave(plot=plots_legend, bg = "white" , here::here("figures", "lfm_flam_metrics.jpeg"), device="jpg")

ggsave(plot=plots_legend, bg = "white" , here::here("figures", "lfm_flam_metrics_withceco.jpeg"), device="jpg")
```
#3. Species Differences

#### Data
```{r}
tidy_data <- read_csv(here::here("processed-data", "analysis 2.0", "tidy_all_mems.csv")) %>% 
  add_row(term = c("sppabco", "sppabco", "sppabco", "sppabco", "sppabco", "sppabco"),
          estimate =c(0,0,0,0,0,0), 
          y_var = c("fh", "fd", "tti", "gd", "prop_ignite", "temp_change")) %>% 
  mutate(upr = estimate + (std.error/2), 
         lwr = estimate - (std.error/2)) %>% 
  mutate(species = case_when(
    term == "sppabco" ~ "A. concolor",
       term ==                "spparpa" ~ "A. patula",
        term ==               "sppcade" ~ "C. decurrens", 
         term ==              "sppceco" ~ "C. cordulatus", 
         term ==              "spppije" ~ "P. jefferyi",
          term ==             "sppquke" ~ "Q. kelloggii"
  )) %>% 
    mutate(y_var_name= case_when(
    y_var == "tti" ~ "Time to ignition",
       y_var ==                "fh" ~ "Flame height",
        y_var ==               "fd" ~ "Flame duration", 
         y_var ==              "prop_ignite" ~ "Prop. ignited", 
         y_var ==              "temp_change" ~ "Temp. change",
          y_var ==             "gd" ~ "Glow duration"
  ))
```
```{r}
unique(tidy_data$term)
```

### Species Effects

```{r, fig.height=3, fig.width=6}
spp_estimates <- tidy_data  %>% 
  filter(term %in% c("sppabco",
                     "spparpa", 
                     "sppcade" ,
                     "sppceco",
                     "spppije",
                     "sppquke"                 
                     )) %>% 
  ggplot(
    aes(color= species)
    ) + 
  geom_point(aes(x = estimate,y = species), size =3) +
    geom_point(aes(x = upr, y = species), size = 1) +
  geom_point(aes(x = lwr, y = species), size = 1) +
  #geom_line(aes(group = species, y = species, x = upr)) +
  geom_segment(aes(x= lwr, xend = upr, y = species, yend = species, color = species))+
  labs(y = "", 
       color = "Species", 
       x = "Estimate") +
    facet_wrap(~y_var_name, scales = "free") + 
theme(
  strip.background = element_blank(),
  strip.text.y = element_blank(), 
  axis.text.y = element_blank(), axis.ticks.y = element_blank()
)+
  geom_vline(xintercept = 0,
             linetype="dotted") +
  color_many2 
spp_estimates

ggsave(plot=spp_estimates, bg = "white" , here::here("figures", "spp_estimates_flam_metrics_withceco.jpeg"), device="jpg")
```

